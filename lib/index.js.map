{"version":3,"file":"index.js","sources":["../src/util.ts","../src/ObserverItem.tsx","../src/VirtList.tsx","../src/RealList.tsx","../src/VirtGrid.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport {\n  isVue2,\n  h,\n  type Component,\n  type ComponentPropsOptions,\n  type ExtractPropTypes,\n  type ComputedOptions,\n  type MethodOptions,\n} from 'vue-demi';\nimport type { RawChildren, RawSlots } from './type';\n\ntype Data = Record<string, unknown>;\ntype Props = Record<string, any> & {\n  attrs?: Record<string, any>;\n};\n\nfunction vue2h<P>(\n  ele:\n    | Component<\n        Readonly<\n          P extends ComponentPropsOptions<Data> ? ExtractPropTypes<P> : P\n        >,\n        any,\n        any,\n        ComputedOptions,\n        MethodOptions,\n        {},\n        any\n      >\n    | string,\n  props: Props,\n  children?: RawChildren | RawSlots,\n) {\n  const { attrs, ...rest } = props;\n  return h(ele, { attrs, ...rest } as any, children);\n}\n\nfunction vue3h<P>(\n  ele:\n    | Component<\n        Readonly<\n          P extends ComponentPropsOptions<Data> ? ExtractPropTypes<P> : P\n        >,\n        any,\n        any,\n        ComputedOptions,\n        MethodOptions,\n        {},\n        any\n      >\n    | string,\n  props: Props,\n  children?: RawChildren | RawSlots,\n) {\n  const { attrs, ...rest } = props;\n  return h(ele, { ...attrs, ...rest } as any, children);\n}\n\nexport const _h = isVue2 ? vue2h : vue3h;\n\nfunction vue2h2Slot<P>(\n  ele:\n    | Component<\n        Readonly<\n          P extends ComponentPropsOptions<Data> ? ExtractPropTypes<P> : P\n        >,\n        any,\n        any,\n        ComputedOptions,\n        MethodOptions,\n        {},\n        any\n      >\n    | string,\n  props: Props,\n  slots?: any,\n) {\n  const { attrs, ...rest } = props;\n  return h(ele, { attrs, ...rest, scopedSlots: slots } as any);\n}\n\n// vue3 渲染slot时推荐使用functional\nfunction vue3h2Slot<P>(\n  ele:\n    | Component<\n        Readonly<\n          P extends ComponentPropsOptions<Data> ? ExtractPropTypes<P> : P\n        >,\n        any,\n        any,\n        ComputedOptions,\n        MethodOptions,\n        {},\n        any\n      >\n    | string,\n  props: Props,\n  slots?: any,\n) {\n  const { attrs, ...rest } = props;\n  return h(ele, { ...attrs, ...rest } as any, slots);\n}\n\n// 渲染传递插槽\nexport const _h2Slot = isVue2 ? vue2h2Slot : vue3h2Slot;\n\nfunction vue2getSlot(_ctx: any, name: string) {\n  return _ctx.$scopedSlots?.[name];\n}\n\nfunction vue3getSlot(_ctx: any, name: string) {\n  return _ctx.$slots?.[name];\n}\n\nexport const getSlot = isVue2 ? vue2getSlot : vue3getSlot;\n","import { defineComponent, onBeforeUnmount, onMounted, ref } from 'vue-demi';\nimport type { ObserverItemProps } from './type';\nimport { _h, getSlot } from './util';\n\nconst useObserverItem = (props: ObserverItemProps) => {\n  const itemRefEl = ref(null);\n\n  onMounted(() => {\n    if (props.resizeObserver && itemRefEl.value) {\n      props.resizeObserver.observe(itemRefEl.value);\n    }\n  });\n\n  onBeforeUnmount(() => {\n    if (props.resizeObserver && itemRefEl.value) {\n      props.resizeObserver.unobserve(itemRefEl.value);\n    }\n  });\n\n  return {\n    itemRefEl,\n  };\n};\nconst ObserverItem = defineComponent({\n  name: 'ObserverItem',\n  props: {\n    resizeObserver: {\n      type: ResizeObserver,\n      require: true,\n    },\n    id: {\n      type: [String, Number],\n      require: true,\n    },\n  },\n  setup(props) {\n    return useObserverItem(props as ObserverItemProps);\n  },\n  render() {\n    const { id } = this;\n    return _h(\n      'div',\n      {\n        ref: 'itemRefEl',\n        attrs: {\n          'data-id': id,\n        },\n      },\n      [getSlot(this, 'default')?.()],\n    );\n  },\n});\n\nexport { ObserverItem, useObserverItem };\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport {\n  isVue2,\n  defineComponent,\n  onBeforeMount,\n  onMounted,\n  onBeforeUnmount,\n  shallowReactive,\n  ref,\n  shallowRef,\n  watch,\n  type ShallowRef,\n  type ShallowReactive,\n  type VNodeChild,\n  type VNode,\n  type SetupContext,\n} from 'vue-demi';\nimport { ObserverItem } from './ObserverItem';\nimport type {\n  EmitFunction,\n  ReactiveData,\n  SlotSize,\n  VirtListProps,\n  VirtListReturn,\n} from './type';\n\nimport { _h, _h2Slot, getSlot } from './util';\n\nconst defaultProps = {\n  fixed: false,\n  buffer: 0,\n  bufferTop: 0,\n  bufferBottom: 0,\n  scrollDistance: 0,\n  horizontal: false,\n  fixSelection: false,\n  start: 0,\n  offset: 0,\n  listStyle: '',\n  listClass: '',\n  itemStyle: '',\n  itemClass: '',\n  headerClass: '',\n  headerStyle: '',\n  footerClass: '',\n  footerStyle: '',\n  stickyHeaderClass: '',\n  stickyHeaderStyle: '',\n  stickyFooterClass: '',\n  stickyFooterStyle: '',\n};\n\nfunction useVirtList<T extends Record<string, any>>(\n  userProps: ShallowReactive<VirtListProps<T>>,\n  emitFunction?: EmitFunction<T>,\n): VirtListReturn<T> {\n  const props = new Proxy(userProps, {\n    get(target, key) {\n      return Reflect.get(target, key) ?? Reflect.get(defaultProps, key);\n    },\n  }) as Required<VirtListProps<T>>;\n\n  const clientRefEl = ref<HTMLElement | null>(null);\n  const listRefEl = ref<HTMLElement | null>(null);\n  const headerRefEl = ref<HTMLElement | null>(null);\n  const footerRefEl = ref<HTMLElement | null>(null);\n  const stickyHeaderRefEl = ref<HTMLElement | null>(null);\n  const stickyFooterRefEl = ref<HTMLElement | null>(null);\n\n  const sizesMap = new Map();\n  const renderKey = ref(0);\n  let direction: 'forward' | 'backward' = 'backward';\n  // 一个手动设置滚动的标志位，用来判断是否需要纠正滚动位置\n  let fixOffset = false;\n  let forceFixOffset = false;\n  let abortFixOffset = false;\n\n  let fixTaskFn: null | (() => void) = null;\n\n  const slotSize: ShallowReactive<SlotSize> = shallowReactive({\n    clientSize: 0,\n    headerSize: 0,\n    footerSize: 0,\n    stickyHeaderSize: 0,\n    stickyFooterSize: 0,\n  });\n\n  // 全局需要响应式的数据\n  const reactiveData: ShallowReactive<ReactiveData> = shallowReactive({\n    // 可视区域的个数，不算buffer，只和clientSize和minSize有关\n    views: 0,\n\n    // 滚动距离\n    offset: 0,\n    // 不包含插槽的高度\n    listTotalSize: 0,\n    // 虚拟占位尺寸，是从0到renderBegin的尺寸\n    virtualSize: 0,\n    // 可视区的起始下标\n    inViewBegin: 0,\n    // 可视区的结束下标\n    inViewEnd: 0,\n\n    // buffer的起始下标\n    renderBegin: 0,\n    // buffer的结束下标\n    renderEnd: 0,\n\n    bufferTop: 0,\n    bufferBottom: 0,\n  });\n\n  function getOffset() {\n    const directionKey = props.horizontal ? 'scrollLeft' : 'scrollTop';\n    return clientRefEl.value ? clientRefEl.value[directionKey] : 0;\n  }\n  function getSlotSize() {\n    return (\n      slotSize.headerSize +\n      slotSize.footerSize +\n      slotSize.stickyHeaderSize +\n      slotSize.stickyFooterSize\n    );\n  }\n  function getTotalSize() {\n    return (\n      reactiveData.listTotalSize +\n      slotSize.headerSize +\n      slotSize.footerSize +\n      slotSize.stickyHeaderSize +\n      slotSize.stickyFooterSize\n    );\n  }\n  function getItemSize(itemKey: string) {\n    if (props.fixed) return props.minSize;\n    return sizesMap.get(String(itemKey)) ?? props.minSize;\n  }\n  function setItemSize(itemKey: string, size: number) {\n    sizesMap.set(String(itemKey), size);\n  }\n  function deleteItemSize(itemKey: string) {\n    sizesMap.delete(String(itemKey));\n  }\n  // 通过下标来获取元素位置信息\n  function getItemPosByIndex(index: number) {\n    if (props.fixed) {\n      return {\n        top: props.minSize * index,\n        current: props.minSize,\n        bottom: props.minSize * (index + 1),\n      };\n    }\n\n    const { itemKey } = props;\n    let topReduce = slotSize.headerSize;\n    for (let i = 0; i <= index - 1; i += 1) {\n      const currentSize = getItemSize(props.list[i]?.[itemKey]);\n      topReduce += currentSize;\n    }\n    const current = getItemSize(props.list[index]?.[itemKey]);\n    return {\n      top: topReduce,\n      current,\n      bottom: topReduce + current,\n    };\n  }\n\n  function scrollToOffset(offset: number) {\n    abortFixOffset = true;\n    const directionKey = props.horizontal ? 'scrollLeft' : 'scrollTop';\n    if (clientRefEl.value) clientRefEl.value[directionKey] = offset;\n  }\n  // expose 滚动到指定下标\n  async function scrollToIndex(index: number) {\n    console.log('scrollToIndex', index);\n\n    if (index < 0) {\n      return;\n    }\n\n    // 如果要去的位置大于长度，那么就直接调用去底部的方法\n    if (index >= props.list.length - 1) {\n      scrollToBottom();\n      return;\n    }\n\n    let { top: lastOffset } = getItemPosByIndex(index);\n\n    scrollToOffset(lastOffset);\n\n    // 这里不适用settimeout，因为无法准确把控延迟时间，3ms有可能页面还拿不到高度。\n    const fixToIndex = () => {\n      const { top: offset } = getItemPosByIndex(index);\n      scrollToOffset(offset);\n      if (lastOffset !== offset) {\n        lastOffset = offset;\n        fixTaskFn = fixToIndex;\n        return;\n      }\n      // 重置后如果不需要修正，将修正函数置空\n      fixTaskFn = null;\n    };\n    fixTaskFn = fixToIndex;\n  }\n  // expose 滚动到可视区域\n  async function scrollIntoView(index: number) {\n    const { top: targetMin, bottom: targetMax } = getItemPosByIndex(index);\n    const offsetMin = getOffset();\n    const offsetMax = getOffset() + slotSize.clientSize;\n    const currentSize = getItemSize(props.list[index]?.[props.itemKey]);\n    if (\n      targetMin < offsetMin &&\n      offsetMin < targetMax &&\n      currentSize < slotSize.clientSize\n    ) {\n      // 如果目标元素上方看不到，底部看得到，那么滚动到顶部部看得到就行了\n      scrollToOffset(targetMin);\n      return;\n    }\n    if (\n      targetMin + slotSize.stickyHeaderSize < offsetMax &&\n      offsetMax < targetMax + slotSize.stickyHeaderSize &&\n      currentSize < slotSize.clientSize\n    ) {\n      // 如果目标元素上方看得到，底部看不到，那么滚动到底部看得到就行了\n      scrollToOffset(\n        targetMax - slotSize.clientSize + slotSize.stickyHeaderSize,\n      );\n      return;\n    }\n\n    // 屏幕下方\n    if (targetMin + slotSize.stickyHeaderSize >= offsetMax) {\n      scrollToIndex(index);\n      return;\n    }\n\n    // 屏幕上方\n    if (targetMax <= offsetMin) {\n      scrollToIndex(index);\n      return;\n    }\n\n    // 在中间就不动了\n  }\n  // expose 滚动到顶部，这个和去第一个元素不同\n  async function scrollToTop() {\n    scrollToOffset(0);\n\n    setTimeout(() => {\n      const directionKey = props.horizontal ? 'scrollLeft' : 'scrollTop';\n      // 因为纠正滚动条会有误差，所以这里需要再次纠正\n      if (clientRefEl?.value?.[directionKey] !== 0) {\n        scrollToTop();\n      }\n    }, 3);\n  }\n  // expose 滚动到底部\n  async function scrollToBottom() {\n    scrollToOffset(getTotalSize());\n\n    setTimeout(() => {\n      // 修复底部误差，因为缩放屏幕的时候，获取的尺寸都是小数，精度会有问题，这里把误差调整为2px\n      if (\n        Math.abs(\n          Math.round(reactiveData.offset + slotSize.clientSize) -\n            Math.round(getTotalSize()),\n        ) > 2\n      ) {\n        scrollToBottom();\n      }\n    }, 3);\n  }\n\n  // 修复vue2-diff的bug导致的selection问题\n  function fixSelection() {\n    const selection = window.getSelection();\n    if (selection) {\n      const { anchorNode, anchorOffset, focusNode, focusOffset } = selection;\n      if (\n        anchorNode &&\n        anchorOffset !== null &&\n        focusNode !== null &&\n        focusOffset\n      ) {\n        requestAnimationFrame(() => {\n          if (anchorOffset < focusOffset) {\n            selection.setBaseAndExtent(\n              anchorNode,\n              anchorOffset,\n              focusNode,\n              focusOffset,\n            );\n          } else {\n            selection.setBaseAndExtent(\n              focusNode,\n              focusOffset,\n              anchorNode,\n              anchorOffset,\n            );\n          }\n        });\n      }\n    }\n  }\n\n  function updateRange(start: number) {\n    // 修复vue2-diff的bug\n    if (isVue2 && props.fixSelection && direction === 'backward') {\n      fixSelection();\n    }\n\n    reactiveData.inViewBegin = start;\n    reactiveData.inViewEnd = Math.min(\n      start + reactiveData.views,\n      props.list.length - 1,\n    );\n\n    // expose\n    emitFunction?.rangeUpdate?.(\n      reactiveData.inViewBegin,\n      reactiveData.inViewEnd,\n    );\n  }\n\n  function calcRange() {\n    const { views, offset, inViewBegin } = reactiveData;\n    const { itemKey } = props;\n\n    const offsetWithNoHeader = offset - slotSize.headerSize;\n    let start = inViewBegin;\n    let offsetReduce = getVirtualSize2beginInView();\n\n    // 当有顶部插槽的时候，快速滚动到顶部，则需要判断，并直接修正\n    if (offsetWithNoHeader < 0) {\n      updateRange(0);\n      return;\n    }\n\n    if (direction === 'forward') {\n      // 1. 没发生变化\n      if (offsetWithNoHeader >= offsetReduce) {\n        // console.log(`👆🏻👆🏻👆🏻👆🏻 for break 没变 start ${start}`);\n        return;\n      }\n      for (let i = start - 1; i >= 0; i -= 1) {\n        // 2. 变化了\n        const currentSize = getItemSize(props.list[i]?.[itemKey]);\n        offsetReduce -= currentSize;\n        // 要计算2个header插槽的高度\n        if (\n          offsetReduce <= offsetWithNoHeader &&\n          offsetWithNoHeader < offsetReduce + currentSize\n        ) {\n          start = i;\n          // console.log(`👆🏻👆🏻👆🏻👆🏻 for break 变了 start ${start}`);\n          break;\n        }\n      }\n\n      // 向上滚动需要修正\n      fixOffset = true;\n    }\n\n    if (direction === 'backward') {\n      if (offsetWithNoHeader <= offsetReduce) {\n        // console.log(`👆🏻👆🏻👆🏻👆🏻 for break 没变 start ${start}`);\n        return;\n      }\n      for (let i = start; i <= props.list.length - 1; i += 1) {\n        // 2. 变化了\n        const currentSize = getItemSize(props.list[i]?.[itemKey]);\n        // console.log('currentSize', i, props.list[i]?.[itemKey], currentSize);\n\n        if (\n          offsetReduce <= offsetWithNoHeader &&\n          offsetWithNoHeader < offsetReduce + currentSize\n        ) {\n          start = i;\n          break;\n        }\n        offsetReduce += currentSize;\n      }\n\n      // 向下滚动不需要修正\n      fixOffset = false;\n    }\n\n    // 节流\n    if (start !== reactiveData.inViewBegin) {\n      updateRange(start);\n    }\n  }\n\n  function onScroll(evt: Event) {\n    // console.log('onscroll');\n\n    emitFunction?.scroll?.(evt);\n\n    const offset = getOffset();\n\n    if (offset === reactiveData.offset) return;\n    direction = offset < reactiveData.offset ? 'forward' : 'backward';\n    reactiveData.offset = offset;\n\n    calcRange();\n\n    // 到达顶部\n    if (\n      direction === 'forward' &&\n      reactiveData.offset - props.scrollDistance <= 0\n    ) {\n      console.log('[VirtList] 到达顶部');\n      emitFunction?.toTop?.(props.list[0]);\n    }\n    // 到达底部 - 放在这里是为了渲染完成拿到真是高度了，再判断是否是真的到达底部\n    // 使用一个 Math.round 来解决小数点的误差问题\n    if (\n      direction === 'backward' &&\n      Math.round(reactiveData.offset + props.scrollDistance) >=\n        Math.round(\n          reactiveData.listTotalSize + getSlotSize() - slotSize.clientSize,\n        )\n    ) {\n      console.log('[VirtList] 到达底部');\n      emitFunction?.toBottom?.(props.list[props.list.length - 1]);\n    }\n  }\n\n  function calcViews() {\n    // 不算buffer的个数\n    const newViews = Math.ceil(slotSize.clientSize / props.minSize) + 1;\n    reactiveData.views = newViews;\n  }\n\n  function onClientResize() {\n    // 可视区域尺寸变化 => 1. 更新可视区域个数 2. 可视区域个数变化后需要及时更新记录尺寸\n    calcViews();\n    updateRange(reactiveData.inViewBegin);\n  }\n\n  function calcListTotalSize() {\n    if (props.fixed) {\n      reactiveData.listTotalSize = props.minSize * props.list.length;\n      return;\n    }\n    const { itemKey } = props;\n    let re = 0;\n    for (let i = 0; i <= props.list.length - 1; i += 1) {\n      re += getItemSize(props.list[i]?.[itemKey]);\n    }\n    reactiveData.listTotalSize = re;\n  }\n\n  function reset() {\n    console.log('[VirtList] reset');\n\n    reactiveData.offset = 0;\n    reactiveData.listTotalSize = 0;\n    reactiveData.virtualSize = 0;\n\n    reactiveData.inViewBegin = 0;\n    reactiveData.inViewEnd = 0;\n\n    reactiveData.renderBegin = 0;\n    reactiveData.renderEnd = 0;\n    sizesMap.clear();\n\n    // [require] 当列表为空时，需要重新渲染，否则会残留渲染\n    forceUpdate();\n  }\n  // expose only\n  function deletedList2Top(deletedList: T[]) {\n    calcListTotalSize();\n    let deletedListSize = 0;\n    deletedList.forEach((item) => {\n      deletedListSize += getItemSize(item[props.itemKey]);\n    });\n    updateTotalVirtualSize();\n    scrollToOffset(reactiveData.offset - deletedListSize);\n    calcRange();\n  }\n  // expose only\n  function addedList2Top(addedList: T[]) {\n    calcListTotalSize();\n    let addedListSize = 0;\n    addedList.forEach((item) => {\n      addedListSize += getItemSize(item[props.itemKey]);\n    });\n    updateTotalVirtualSize();\n    scrollToOffset(reactiveData.offset + addedListSize);\n    forceFixOffset = true;\n    abortFixOffset = false;\n    calcRange();\n  }\n\n  function forceUpdate() {\n    renderKey.value += 1;\n  }\n\n  let resizeObserver: ResizeObserver | undefined = undefined;\n  if (typeof ResizeObserver !== 'undefined') {\n    resizeObserver = new ResizeObserver((entries) => {\n      // FIXME 这里加了requestIdleCallback会有问题，暂时不知道为什么\n      // 延迟执行，快速滚动的时候是没有必要的\n      // requestIdleCallback(() => {\n      let diff = 0;\n      for (const entry of entries) {\n        const id = (entry.target as HTMLElement).dataset.id;\n\n        if (id) {\n          const oldSize = getItemSize(id);\n\n          let newSize = 0;\n          // 兼容性处理，详情：https://developer.mozilla.org/zh-CN/docs/Web/API/ResizeObserver\n          // ios中没有borderBoxSize，只有contentRect\n          if (entry.borderBoxSize) {\n            // Firefox implements `contentBoxSize` as a single content rect, rather than an array\n            const contentBoxSize = Array.isArray(entry.contentBoxSize)\n              ? entry.contentBoxSize[0]\n              : entry.contentBoxSize;\n            newSize = props.horizontal\n              ? contentBoxSize.inlineSize\n              : contentBoxSize.blockSize;\n          } else {\n            newSize = props.horizontal\n              ? entry.contentRect.width\n              : entry.contentRect.height;\n          }\n\n          if (id === 'client') {\n            slotSize.clientSize = newSize;\n            onClientResize();\n          } else if (id === 'header') {\n            slotSize.headerSize = newSize;\n          } else if (id === 'footer') {\n            slotSize.footerSize = newSize;\n          } else if (id === 'stickyHeader') {\n            slotSize.stickyHeaderSize = newSize;\n          } else if (id === 'stickyFooter') {\n            slotSize.stickyFooterSize = newSize;\n          } else if (oldSize !== newSize) {\n            setItemSize(id, newSize);\n            diff += newSize - oldSize;\n            emitFunction?.itemResize?.(id, newSize);\n          }\n        }\n      }\n      reactiveData.listTotalSize += diff;\n\n      // 如果有需要修正的方法进行修正\n      if (fixTaskFn) {\n        fixTaskFn();\n      }\n      // console.log(fixOffset, forceFixOffset, diff);\n      // 向上滚动纠正误差 - 当没有顶部buffer的时候是需要的\n      if ((fixOffset || forceFixOffset) && diff !== 0 && !abortFixOffset) {\n        fixOffset = false;\n        forceFixOffset = false;\n        scrollToOffset(reactiveData.offset + diff);\n        // console.log('纠正误差', reactiveData.offset, diff);\n      }\n      abortFixOffset = false;\n    });\n  }\n\n  const updateTotalVirtualSize = () => {\n    let offset = 0;\n    const currentFirst = reactiveData.renderBegin;\n    for (let i = 0; i < currentFirst; i++) {\n      offset += getItemSize(props.list[i]?.[props.itemKey]);\n    }\n    reactiveData.virtualSize = offset;\n  };\n\n  onBeforeMount(() => {\n    if (props.bufferTop) {\n      reactiveData.bufferTop = props.bufferTop;\n    } else {\n      reactiveData.bufferTop = props.buffer;\n    }\n\n    if (props.bufferBottom) {\n      reactiveData.bufferBottom = props.bufferBottom;\n    } else {\n      reactiveData.bufferBottom = props.buffer;\n    }\n  });\n\n  onMounted(() => {\n    if (clientRefEl.value) {\n      clientRefEl.value.addEventListener('scroll', onScroll);\n\n      resizeObserver?.observe(clientRefEl.value);\n    }\n\n    if (stickyHeaderRefEl.value) {\n      resizeObserver?.observe(stickyHeaderRefEl.value);\n    }\n    if (stickyFooterRefEl.value) {\n      resizeObserver?.observe(stickyFooterRefEl.value);\n    }\n    if (headerRefEl.value) {\n      resizeObserver?.observe(headerRefEl.value);\n    }\n    if (footerRefEl.value) {\n      resizeObserver?.observe(footerRefEl.value);\n    }\n\n    if (props.start) {\n      scrollToIndex(props.start);\n    } else if (props.offset) {\n      scrollToOffset(props.offset);\n    }\n  });\n\n  onBeforeUnmount(() => {\n    if (clientRefEl.value) {\n      clientRefEl.value.removeEventListener('scroll', onScroll);\n\n      resizeObserver?.unobserve(clientRefEl.value);\n      slotSize.clientSize = 0;\n    }\n\n    if (stickyHeaderRefEl.value) {\n      resizeObserver?.unobserve(stickyHeaderRefEl.value);\n      slotSize.stickyHeaderSize = 0;\n    }\n    if (stickyFooterRefEl.value) {\n      resizeObserver?.unobserve(stickyFooterRefEl.value);\n      slotSize.stickyFooterSize = 0;\n    }\n    if (headerRefEl.value) {\n      resizeObserver?.unobserve(headerRefEl.value);\n      slotSize.headerSize = 0;\n    }\n    if (footerRefEl.value) {\n      resizeObserver?.unobserve(footerRefEl.value);\n      slotSize.footerSize = 0;\n    }\n  });\n\n  function getVirtualSize2beginInView() {\n    return (\n      reactiveData.virtualSize +\n      getRangeSize(reactiveData.renderBegin, reactiveData.inViewBegin)\n    );\n  }\n\n  function getRangeSize(range1: number, range2: number) {\n    const start = Math.min(range1, range2);\n    const end = Math.max(range1, range2);\n    let re = 0;\n    for (let i = start; i < end; i += 1) {\n      re += getItemSize(props.list[i]?.[props.itemKey]);\n    }\n    return re;\n  }\n\n  const renderList: ShallowRef<T[]> = shallowRef([]);\n\n  function manualRender(_newRenderBegin: number, _newRenderEnd: number) {\n    // 旧的渲染起始\n    const _oldRenderBegin = reactiveData.renderBegin;\n\n    // update render begin\n    reactiveData.renderBegin = _newRenderBegin;\n    // update render end\n    reactiveData.renderEnd = _newRenderEnd;\n    // update virtualSize, diff range size\n    if (_newRenderBegin > _oldRenderBegin) {\n      reactiveData.virtualSize += getRangeSize(\n        _newRenderBegin,\n        _oldRenderBegin,\n      );\n    } else {\n      reactiveData.virtualSize -= getRangeSize(\n        _newRenderBegin,\n        _oldRenderBegin,\n      );\n    }\n    // update render list\n    renderList.value = props.list.slice(\n      reactiveData.renderBegin,\n      reactiveData.renderEnd + 1,\n    );\n    // update size\n    updateTotalVirtualSize();\n  }\n\n  watch(\n    // 这里为什么用 renderKey 代替监听 props.list\n    // 因为props.list会导致v-for时deepArray导致大量的性能浪费\n    () => [reactiveData.inViewBegin, reactiveData.inViewEnd, renderKey.value],\n    (newVal, oldVal) => {\n      if (newVal && oldVal) {\n        // console.log('watch', newVal, oldVal);\n        const [_newInViewBegin] = newVal;\n\n        // 旧的渲染起始\n        const _oldRenderBegin = reactiveData.renderBegin;\n\n        // 新的渲染起始\n        let _newRenderBegin = _newInViewBegin;\n        // 新的渲染结束\n        let _newRenderEnd = reactiveData.inViewEnd;\n\n        // 计算buffer\n        _newRenderBegin = Math.max(0, _newRenderBegin - reactiveData.bufferTop);\n        _newRenderEnd = Math.min(\n          _newRenderEnd + reactiveData.bufferBottom,\n          props.list.length - 1 > 0 ? props.list.length - 1 : 0,\n        );\n\n        // 控制层渲染，等于说要覆盖掉buffer\n        if (props?.renderControl) {\n          const { begin, end } = props.renderControl(\n            _newInViewBegin,\n            reactiveData.inViewEnd,\n          );\n          _newRenderBegin = begin;\n          _newRenderEnd = end;\n        }\n\n        // update render begin\n        reactiveData.renderBegin = _newRenderBegin;\n        // update render end\n        reactiveData.renderEnd = _newRenderEnd;\n        // update virtualSize, diff range size\n        if (_newRenderBegin > _oldRenderBegin) {\n          reactiveData.virtualSize += getRangeSize(\n            _newRenderBegin,\n            _oldRenderBegin,\n          );\n        } else {\n          reactiveData.virtualSize -= getRangeSize(\n            _newRenderBegin,\n            _oldRenderBegin,\n          );\n        }\n        // update render list\n        renderList.value = props.list.slice(\n          reactiveData.renderBegin,\n          reactiveData.renderEnd + 1,\n        );\n      }\n    },\n    {\n      immediate: true,\n    },\n  );\n\n  watch(\n    () => props.list.length,\n    () => {\n      // 如果数据为空，那么就重置\n      if (props.list.length <= 0) {\n        reset();\n        return;\n      }\n\n      // [require] 因为list长度变化，所以总高度有变化\n      calcListTotalSize();\n      // [require] 因为list长度变化，所以重新计算起始结束位置\n      updateRange(reactiveData.inViewBegin);\n      // [require] 如果顶部列表数据发生变更需要更正顶部高度\n      updateTotalVirtualSize();\n      // [require] 列表长度切内容发生变化，如果起始位置没变，则需要强制更新一下页面\n      forceUpdate();\n    },\n    {\n      immediate: true,\n    },\n  );\n\n  return {\n    props,\n\n    renderList,\n\n    clientRefEl,\n    listRefEl,\n    headerRefEl,\n    footerRefEl,\n    stickyHeaderRefEl,\n    stickyFooterRefEl,\n\n    reactiveData,\n    slotSize,\n    sizesMap,\n\n    resizeObserver,\n\n    getOffset,\n    getSlotSize,\n    reset,\n    scrollToIndex,\n    manualRender,\n    scrollIntoView,\n    scrollToTop,\n    scrollToBottom,\n    scrollToOffset,\n    getItemSize,\n    deleteItemSize,\n    // expose only\n    deletedList2Top,\n    addedList2Top,\n    getItemPosByIndex,\n    forceUpdate,\n  };\n}\nconst VirtList = defineComponent({\n  name: 'VirtList',\n  props: {\n    list: {\n      type: Array<any>,\n      default: () => [],\n    },\n    // 数据key\n    itemKey: {\n      type: [String, Number],\n      required: true,\n    },\n    // 最小尺寸\n    minSize: {\n      type: Number,\n      default: 20,\n      required: true,\n    },\n    renderControl: {\n      type: Function,\n      default: undefined,\n    },\n    fixed: {\n      type: Boolean,\n      default: false,\n    },\n    buffer: {\n      type: Number,\n      default: 0,\n    },\n    bufferTop: {\n      type: Number,\n      default: 0,\n    },\n    bufferBottom: {\n      type: Number,\n      default: 0,\n    },\n    // 滚动距离阈值\n    scrollDistance: {\n      type: Number,\n      default: 0,\n    },\n    // 是否为水平移动\n    horizontal: {\n      type: Boolean,\n      default: false,\n    },\n    // 起始下标\n    start: {\n      type: Number,\n      default: 0,\n    },\n    // 起始偏移量\n    offset: {\n      type: Number,\n      default: 0,\n    },\n    listStyle: {\n      type: String,\n      default: '',\n    },\n    listClass: {\n      type: String,\n      default: '',\n    },\n    itemStyle: {\n      type: String,\n      default: '',\n    },\n    itemClass: {\n      type: String,\n      default: '',\n    },\n    headerClass: {\n      type: String,\n      default: '',\n    },\n    headerStyle: {\n      type: String,\n      default: '',\n    },\n    footerClass: {\n      type: String,\n      default: '',\n    },\n    footerStyle: {\n      type: String,\n      default: '',\n    },\n    stickyHeaderClass: {\n      type: String,\n      default: '',\n    },\n    stickyHeaderStyle: {\n      type: String,\n      default: '',\n    },\n    stickyFooterClass: {\n      type: String,\n      default: '',\n    },\n    stickyFooterStyle: {\n      type: String,\n      default: '',\n    },\n  },\n  setup(props: any, context: SetupContext) {\n    const emitFunction: EmitFunction<any> = {\n      scroll: (evt: Event) => {\n        context.emit('scroll', evt);\n      },\n      toTop: (firstItem: any) => {\n        context.emit('toTop', firstItem);\n      },\n      toBottom: (lastItem: any) => {\n        context.emit('toBottom', lastItem);\n      },\n      itemResize: (id: string, newSize: number) => {\n        context.emit('itemResize', id, newSize);\n      },\n      rangeUpdate: (inViewBegin: number, inViewEnd: number) => {\n        context.emit('rangeUpdate', inViewBegin, inViewEnd);\n      },\n    };\n\n    return useVirtList(props, emitFunction);\n  },\n  render() {\n    const { renderList, reactiveData, resizeObserver } = this;\n    const {\n      itemKey,\n      horizontal,\n      listStyle,\n      listClass,\n      itemStyle,\n      itemClass,\n      headerClass,\n      headerStyle,\n      footerClass,\n      footerStyle,\n      stickyHeaderClass,\n      stickyHeaderStyle,\n      stickyFooterClass,\n      stickyFooterStyle,\n    } = this.props;\n\n    const renderStickyHeaderSlot = (): VNode | null =>\n      getSlot(this, 'stickyHeader')\n        ? _h(\n            'div',\n            {\n              key: 'slot-sticky-header',\n              class: stickyHeaderClass,\n              style: `position: sticky; z-index: 10; ${\n                horizontal ? 'left: 0' : 'top: 0;'\n              } ${stickyHeaderStyle}`,\n              ref: 'stickyHeaderRefEl',\n              attrs: {\n                'data-id': 'stickyHeader',\n              },\n            },\n            [getSlot(this, 'stickyHeader')?.()],\n          )\n        : null;\n\n    const renderStickyFooterSlot = (): VNode | null =>\n      getSlot(this, 'stickyFooter')\n        ? _h(\n            'div',\n            {\n              key: 'slot-sticky-footer',\n              class: stickyFooterClass,\n              style: `position: sticky; z-index: 10; ${\n                horizontal ? 'right: 0' : 'bottom: 0;'\n              } ${stickyFooterStyle}`,\n              ref: 'stickyFooterRefEl',\n              attrs: {\n                'data-id': 'stickyFooter',\n              },\n            },\n            [getSlot(this, 'stickyFooter')?.()],\n          )\n        : null;\n\n    const renderHeaderSlot = (): VNode | null =>\n      getSlot(this, 'header')\n        ? _h(\n            'div',\n            {\n              key: 'slot-header',\n              class: headerClass,\n              style: headerStyle,\n              ref: 'headerRefEl',\n              attrs: { 'data-id': 'header' },\n            },\n            [getSlot(this, 'header')?.()],\n          )\n        : null;\n\n    const renderFooterSlot = (): VNode | null =>\n      getSlot(this, 'footer')\n        ? _h(\n            'div',\n            {\n              key: 'slot-footer',\n              class: footerClass,\n              style: footerStyle,\n              ref: 'footerRefEl',\n              attrs: {\n                'data-id': 'footer',\n              },\n            },\n            [getSlot(this, 'footer')?.()],\n          )\n        : null;\n\n    const { listTotalSize, virtualSize, renderBegin } = reactiveData;\n\n    const renderMainList = (): VNode | null => {\n      const mainList = [];\n      for (let index = 0; index < renderList.length; index += 1) {\n        const currentItem = renderList[index];\n        mainList.push(\n          _h(\n            ObserverItem,\n            {\n              key: currentItem[itemKey],\n              class: itemClass,\n              style: itemStyle,\n              attrs: {\n                id: currentItem[itemKey],\n                resizeObserver: resizeObserver,\n              },\n            },\n            // vue3 推荐使用 functional\n            isVue2\n              ? [\n                  getSlot(\n                    this,\n                    'default',\n                  )?.({\n                    itemData: currentItem,\n                    index: renderBegin + index,\n                  }),\n                ]\n              : {\n                  default: () =>\n                    getSlot(\n                      this,\n                      'default',\n                    )?.({\n                      itemData: currentItem,\n                      index: renderBegin + index,\n                    }),\n                },\n          ),\n        );\n      }\n\n      if (mainList.length === 0 && getSlot(this, 'empty')) {\n        const height = this.slotSize.clientSize - this.getSlotSize();\n        mainList.push(\n          _h(\n            'div',\n            {\n              key: `slot-empty-${height}`,\n              style: `height: ${height}px`,\n            },\n            [getSlot(this, 'empty')?.()],\n          ),\n        );\n      }\n\n      const dynamicListStyle = horizontal\n        ? `will-change: width; min-width: ${listTotalSize}px; display: flex; ${listStyle}`\n        : `will-change: height; min-height: ${listTotalSize}px; ${listStyle}`;\n      const virtualStyle = horizontal\n        ? `width: ${virtualSize}px; will-change: width;`\n        : `height: ${virtualSize}px; will-change: height;`;\n\n      return _h(\n        'div',\n        {\n          ref: 'listRefEl',\n          class: listClass,\n          style: dynamicListStyle,\n        },\n        [\n          _h('div', {\n            style: virtualStyle,\n          }),\n          mainList,\n        ],\n      );\n    };\n\n    // const renderVirtualScrollbar = () => {\n    //   return <div style={`float: left; height: ${listTotalSize}px`}></div>; // 虚拟滚动条\n    // };\n\n    return _h(\n      'div',\n      {\n        ref: 'clientRefEl',\n        class: 'virt-list__client',\n        style: `width: 100%; height: 100%; overflow: overlay;`,\n        attrs: {\n          'data-id': 'client',\n        },\n      },\n      [\n        renderStickyHeaderSlot(),\n        renderHeaderSlot(),\n        renderMainList(),\n        renderFooterSlot(),\n        renderStickyFooterSlot(),\n      ],\n    );\n  },\n});\n\nexport { VirtList, useVirtList };\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport {\n  defineComponent,\n  onBeforeUnmount,\n  onBeforeUpdate,\n  onMounted,\n  onUpdated,\n  ref,\n  shallowReactive,\n  watch,\n  type ShallowReactive,\n  type VNode,\n} from 'vue-demi';\nimport { ObserverItem } from './ObserverItem';\nimport { _h, getSlot } from './util';\nimport type { NormalEmitFunction, SlotSize, RealListProps } from './type';\n\nconst defaultProps = {\n  itemKey: 'id',\n  miniSize: 40,\n  list: [],\n  scrollDistance: 100,\n  headerClass: '',\n  headerStyle: '',\n  footerClass: '',\n  footerStyle: '',\n  stickyHeaderClass: '',\n  stickyHeaderStyle: '',\n  stickyFooterClass: '',\n  stickyFooterStyle: '',\n};\n\nconst useRealList = <T extends Record<string, any>>(\n  userProps: ShallowReactive<RealListProps<T>>,\n  emitFunction?: NormalEmitFunction<T>,\n) => {\n  const props = new Proxy(userProps, {\n    get(target, key) {\n      return Reflect.get(target, key) ?? Reflect.get(defaultProps, key);\n    },\n  }) as Required<RealListProps<T>>;\n\n  const clientRefEl = ref<HTMLElement | null>(null);\n  const listRefEl = ref<HTMLElement | null>(null);\n  const headerRefEl = ref<HTMLElement | null>(null);\n  const footerRefEl = ref<HTMLElement | null>(null);\n  const stickyHeaderRefEl = ref<HTMLElement | null>(null);\n  const stickyFooterRefEl = ref<HTMLElement | null>(null);\n\n  const sizesMap = new Map();\n  const offsetMap = new Map();\n\n  // 插槽的相关尺寸数据\n  const slotSize: ShallowReactive<SlotSize> = shallowReactive({\n    clientSize: 0,\n    headerSize: 0,\n    footerSize: 0,\n    stickyHeaderSize: 0,\n    stickyFooterSize: 0,\n  });\n  const reactiveData = shallowReactive({\n    listTotalSize: 0, // 不包含插槽的高度\n    begin: '',\n    end: '',\n  });\n\n  // 滚动到顶部和底部的标志位\n  const isScrollTop = ref(false);\n  const isScrollBottom = ref(false);\n\n  const isUpdating = ref(false);\n\n  const calcListTotalSize = () => {\n    // 计算当前所有列表的高度\n    const { itemKey } = props;\n    let re = 0;\n    for (let i = 0; i <= props.list.length - 1; i += 1) {\n      re += getItemSize(props.list[i]?.[itemKey]);\n    }\n    reactiveData.listTotalSize = re;\n  };\n\n  const getItemSize = (itemKey: string) =>\n    sizesMap.get(String(itemKey)) ?? props.minSize;\n\n  const setItemSize = (itemKey: string, size: number) => {\n    sizesMap.set(String(itemKey), size);\n  };\n\n  // 获取当前的容器的滚动偏移量\n  const getScrollOffset = () =>\n    clientRefEl.value ? clientRefEl.value.scrollTop : 0;\n\n  let resizeObserver: ResizeObserver | undefined = undefined;\n  if (typeof ResizeObserver !== 'undefined') {\n    resizeObserver = new ResizeObserver((entries) => {\n      // 尺寸变化的时候其实需要去更新元素的sizeMap和offsetMap\n      let diff = 0;\n      for (const entry of entries) {\n        const { id } = (entry.target as HTMLElement).dataset;\n\n        if (id) {\n          const prevSize = getItemSize(id);\n          const currentSize = entry.contentBoxSize[0].blockSize;\n\n          if (id === 'client') {\n            slotSize.clientSize = currentSize;\n          } else if (id === 'header') {\n            slotSize.headerSize = currentSize;\n          } else if (id === 'footer') {\n            slotSize.footerSize = currentSize;\n          } else if (id === 'stickyHeader') {\n            slotSize.stickyHeaderSize = currentSize;\n          } else if (id === 'stickyFooter') {\n            slotSize.stickyFooterSize = currentSize;\n          } else if (prevSize !== currentSize) {\n            setItemSize(id, currentSize);\n            diff += currentSize - prevSize;\n\n            emitFunction?.itemResize?.(id, currentSize);\n          }\n        }\n      }\n\n      // 更新列表的整体尺寸\n      reactiveData.listTotalSize += diff;\n\n      // 纠正所有列表的误差，防止有的列表没有更新diff\n      calcListTotalSize();\n      updateOffset();\n\n      // 只有列表更新时候的尺寸变化才需要主动修正位置\n      if (isUpdating.value) {\n        if (isScrollTop.value) scrollIntoPosition('forward');\n        if (isScrollBottom.value) scrollIntoPosition('backward');\n        return;\n      }\n\n      // 元素尺寸变化的时候，需要判断是否触底或者触顶\n      const currentScrollOffset = getScrollOffset();\n      checkScrollStatus(currentScrollOffset);\n    });\n  }\n\n  const getItemOffset = (itemKey: string) =>\n    offsetMap.get(String(itemKey)) ?? -1;\n\n  const setItemOffset = (itemKey: string, size: number) => {\n    offsetMap.set(String(itemKey), size);\n  };\n\n  const updateOffset = () => {\n    const { itemKey } = props;\n    offsetMap.clear();\n    let offset = 0;\n    for (let i = 0; i < props.list.length; i += 1) {\n      setItemOffset(props.list[i]?.[itemKey], offset);\n      offset += getItemSize(props.list[i]?.[itemKey]);\n    }\n  };\n\n  const getSlotSize = () =>\n    slotSize.headerSize + slotSize.stickyFooterSize + slotSize.stickyHeaderSize;\n\n  const debounce = (func: () => void, wait: number) => {\n    let timeout: NodeJS.Timeout;\n\n    return function () {\n      clearTimeout(timeout);\n      timeout = setTimeout(() => func(), wait);\n    };\n  };\n\n  // 当前可视区域内的第一个元素的key\n  let currentKey = '';\n\n  const updateFirstKey = debounce(() => {\n    currentKey = getCurrentFirstItem();\n    emitFunction?.updateCurrent?.(currentKey);\n    // ctx.emit('updateCurrent', currentKey);\n  }, 200);\n\n  /**\n   * @description 判断当前滚动的状态，判断是否触顶或者触底\n   * @param currentScrollOffset 当前列表滚动的偏移量\n   */\n  const checkScrollStatus = (currentScrollOffset: number) => {\n    if (props.list.length <= 0) return;\n    if (currentScrollOffset <= props.scrollDistance) {\n      reactiveData.begin = props.list[0][props.itemKey];\n      if (props.list.length > props.pageSize) {\n        reactiveData.end =\n          props.list[props.list.length - props.pageSize - 1][props.itemKey];\n      } else {\n        reactiveData.end = props.list[props.list.length - 1][props.itemKey];\n      }\n      emitFunction?.toTop?.(props.list[0]);\n      // ctx.emit('toTop', props.list[0]);\n      isScrollBottom.value = false;\n      isScrollTop.value = true;\n    }\n    // 内容总高度 = 列表总高度 + 头部插槽高度 + 尾部插槽高度\n    // reactiveData.listTotalSize + slotSize.headerSize + slotSize.footerSize\n    // 滚动高度 + 可视区域高度 + 阈值 >= 内容总高度\n    if (\n      currentScrollOffset + props.scrollDistance >=\n      reactiveData.listTotalSize + getSlotSize() - slotSize.clientSize\n    ) {\n      reactiveData.end = props.list[props.list.length - 1][props.itemKey];\n      if (props.list.length > props.pageSize) {\n        reactiveData.begin = props.list[props.pageSize][props.itemKey];\n      } else {\n        reactiveData.begin = props.list[0][props.itemKey];\n      }\n      emitFunction?.toBottom?.(props.list[props.list.length - 1]);\n      // ctx.emit('toBottom', props.list[props.list.length - 1]);\n      isScrollBottom.value = true;\n      isScrollTop.value = false;\n    }\n  };\n\n  const onScroll = (evt: Event) => {\n    emitFunction?.scroll?.(evt);\n    // ctx.emit('scroll', evt);\n    if (props.list.length <= 0) return;\n    const currentScrollOffset = getScrollOffset();\n    if (isUpdating.value) {\n      const currentStartOffset = getItemOffset(reactiveData.begin);\n      if (currentScrollOffset < currentStartOffset) {\n        scrollToOffset(currentStartOffset);\n      }\n      return;\n    }\n\n    updateFirstKey();\n    checkScrollStatus(currentScrollOffset);\n  };\n\n  const scrollToOffset = (offset: number) => {\n    const directionKey = 'scrollTop';\n    if (clientRefEl.value) clientRefEl.value[directionKey] = offset;\n  };\n\n  /**\n   * @description 将指定下标的元素滚动到可视区域\n   * @param index 目标元素下标\n   */\n  const scrollIntoView = (index: number) => {\n    // 滚动指定元素到可视区域\n    const targetMin = getItemOffset(props.list[index]?.[props.itemKey]);\n\n    const scrollTargetToView = async (\n      targetMin: number,\n      resolve: (val?: unknown) => void,\n    ) => {\n      // 如果没有拿到目标元素的位置，那么就等一下再去拿\n      if (targetMin === -1) {\n        setTimeout(() => {\n          const offset = getItemOffset(props.list[index]?.[props.itemKey]);\n          scrollTargetToView(offset, resolve);\n        }, 3);\n        return;\n      }\n\n      const currentSize = getItemSize(props.list[index]?.[props.itemKey]);\n      const targetMax = targetMin + currentSize;\n\n      const offsetMin = getScrollOffset();\n      const offsetMax = getScrollOffset() + slotSize.clientSize;\n      if (\n        targetMin < offsetMin &&\n        offsetMin < targetMax &&\n        currentSize < slotSize.clientSize\n      ) {\n        // 如果目标元素上方看不到，底部看得到，那么滚动到顶部部看得到就行了\n        scrollToOffset(targetMin + slotSize.headerSize);\n        resolve();\n        return;\n      }\n      if (\n        targetMin + slotSize.stickyHeaderSize < offsetMax &&\n        offsetMax < targetMax + slotSize.stickyHeaderSize &&\n        currentSize < slotSize.clientSize\n      ) {\n        // 如果目标元素上方看得到，底部看不到，那么滚动到底部看得到就行了\n        scrollToOffset(\n          targetMax - slotSize.clientSize + slotSize.stickyHeaderSize,\n        );\n        resolve();\n        return;\n      }\n      // 屏幕下方\n      if (targetMin + slotSize.stickyHeaderSize >= offsetMax) {\n        await scrollToIndex(index);\n        resolve();\n        return;\n      }\n\n      // 屏幕上方\n      if (targetMax <= offsetMin) {\n        await scrollToIndex(index);\n      }\n      resolve();\n\n      // 在中间就不动了\n    };\n    return new Promise((resolve) => {\n      scrollTargetToView(targetMin, resolve);\n    });\n  };\n\n  const getOffsetByIndex = (index: number) => {\n    const key = props.list[index]?.[props.itemKey];\n    return getItemOffset(key);\n  };\n\n  /**\n   * @description 获取当前可视区域内的第一个元素的key\n   * @returns 当前可视区域的一个元素的key\n   */\n  const getCurrentFirstItem = () => {\n    let currentKey = '';\n    const currentScrollOffset = getScrollOffset();\n    const preDistance =\n      currentScrollOffset + slotSize.stickyHeaderSize - slotSize.headerSize;\n    const distance = preDistance < 0 ? 0 : preDistance;\n    for (const [key, value] of offsetMap) {\n      if (value <= distance && value + getItemSize(key) > currentScrollOffset) {\n        currentKey = key;\n        break;\n      }\n    }\n    return currentKey;\n  };\n\n  /**\n   * @description 将指定下标的元素滚动到可视区域第一个位置\n   * @param index 目标元素下标\n   */\n  const scrollToIndex = (index: number) => {\n    // 滚动到指定元素\n    if (index < 0) return;\n    // 如果要去的位置大于长度，那么就直接调用去底部的方法\n    if (index >= props.list.length - 1) {\n      scrollToBottom();\n      return;\n    }\n\n    const offset = getItemOffset(props.list[index]?.[props.itemKey]);\n    const scrollToTargetOffset = (\n      targetOffset: number,\n      resolve: (val?: unknown) => void,\n    ) => {\n      if (targetOffset === -1) {\n        setTimeout(() => {\n          const offset = getItemOffset(props.list[index]?.[props.itemKey]);\n          scrollToTargetOffset(offset, resolve);\n        }, 3);\n        return;\n      }\n      scrollToOffset(targetOffset + slotSize.headerSize);\n      resolve();\n    };\n    return new Promise((resolve) => {\n      scrollToTargetOffset(offset, resolve);\n    });\n  };\n\n  const scrollToBottom = () => {\n    const bottomOffset =\n      reactiveData.listTotalSize + slotSize.headerSize + slotSize.footerSize;\n    scrollToOffset(bottomOffset);\n  };\n  let preScrollOffset = 0;\n\n  const scrollIntoPosition = (direction: 'forward' | 'backward') => {\n    if (!clientRefEl.value) return;\n    if (direction === 'forward') {\n      scrollToOffset(preScrollOffset + getItemOffset(reactiveData.begin));\n    } else {\n      scrollToOffset(preScrollOffset);\n    }\n  };\n\n  const reset = () => {\n    // 重置所有的数据\n    reactiveData.listTotalSize = 0;\n\n    reactiveData.begin = '';\n    reactiveData.end = '';\n\n    sizesMap.clear();\n    offsetMap.clear();\n  };\n\n  watch(\n    () => props.list,\n    () => {\n      // 在数据变化的时候才去将更新状态位设置为true\n      // 防止多次触发分页操作\n      isUpdating.value = true;\n    },\n    {\n      deep: false,\n    },\n  );\n\n  onBeforeUpdate(() => {\n    // 已经拿到了新的列表\n    if (isScrollTop.value) {\n      preScrollOffset = getScrollOffset();\n    }\n    if (isScrollBottom.value) {\n      preScrollOffset =\n        getScrollOffset() - offsetMap.get(String(reactiveData.begin));\n    }\n  });\n\n  onUpdated(() => {\n    // 这个时候已经更新完成了 但是滚动会触发阈值的判断，所以需要延迟一下\n    setTimeout(() => {\n      isUpdating.value = false;\n    }, 10);\n  });\n\n  onMounted(() => {\n    if (clientRefEl.value) {\n      clientRefEl.value.addEventListener('scroll', onScroll);\n      resizeObserver?.observe(clientRefEl.value);\n    }\n\n    if (stickyHeaderRefEl.value) {\n      resizeObserver?.observe(stickyHeaderRefEl.value);\n    }\n    if (stickyFooterRefEl.value) {\n      resizeObserver?.observe(stickyFooterRefEl.value);\n    }\n    if (headerRefEl.value) {\n      resizeObserver?.observe(headerRefEl.value);\n    }\n    if (footerRefEl.value) {\n      resizeObserver?.observe(footerRefEl.value);\n    }\n  });\n\n  onBeforeUnmount(() => {\n    if (clientRefEl.value) {\n      clientRefEl.value.removeEventListener('scroll', onScroll);\n      resizeObserver?.unobserve(clientRefEl.value);\n      slotSize.clientSize = 0;\n    }\n\n    if (stickyHeaderRefEl.value) {\n      resizeObserver?.unobserve(stickyHeaderRefEl.value);\n      slotSize.stickyHeaderSize = 0;\n    }\n    if (stickyFooterRefEl.value) {\n      resizeObserver?.unobserve(stickyFooterRefEl.value);\n      slotSize.stickyFooterSize = 0;\n    }\n    if (headerRefEl.value) {\n      resizeObserver?.unobserve(headerRefEl.value);\n      slotSize.headerSize = 0;\n    }\n    if (footerRefEl.value) {\n      resizeObserver?.unobserve(footerRefEl.value);\n      slotSize.footerSize = 0;\n    }\n  });\n\n  return {\n    props,\n    resizeObserver,\n    sizesMap,\n    slotSize,\n\n    clientRefEl,\n    listRefEl,\n    headerRefEl,\n    footerRefEl,\n    stickyHeaderRefEl,\n    stickyFooterRefEl,\n\n    scrollIntoView,\n    scrollToIndex,\n    reset,\n    getItemOffset,\n    getCurrentFirstItem,\n    getOffsetByIndex,\n    scrollToOffset,\n  };\n};\n\nconst RealList = defineComponent({\n  name: 'RealList',\n  props: {\n    itemKey: {\n      type: [String, Number],\n      default: 'id',\n    },\n    list: {\n      type: Array<any>,\n      default: () => [],\n    },\n    minSize: {\n      type: Number,\n      default: 40,\n    },\n    pageSize: {\n      type: Number,\n      default: 30,\n    },\n    scrollDistance: {\n      type: Number,\n      default: 100,\n    },\n    headerClass: {\n      type: String,\n      default: '',\n    },\n    headerStyle: {\n      type: String,\n      default: '',\n    },\n    footerClass: {\n      type: String,\n      default: '',\n    },\n    footerStyle: {\n      type: String,\n      default: '',\n    },\n    stickyHeaderClass: {\n      type: String,\n      default: '',\n    },\n    stickyHeaderStyle: {\n      type: String,\n      default: '',\n    },\n    stickyFooterClass: {\n      type: String,\n      default: '',\n    },\n    stickyFooterStyle: {\n      type: String,\n      default: '',\n    },\n  },\n  setup(props, ctx) {\n    const emitFunction: NormalEmitFunction<any> = {\n      scroll: (evt: Event) => {\n        ctx.emit('scroll', evt);\n      },\n      toTop: (firstItem: any) => {\n        ctx.emit('toTop', firstItem);\n      },\n      toBottom: (lastItem: any) => {\n        ctx.emit('toBottom', lastItem);\n      },\n      itemResize: (id: string, newSize: number) => {\n        ctx.emit('itemResize', id, newSize);\n      },\n      updateCurrent: (key: string | number) => {\n        ctx.emit('updateCurrent', key);\n      },\n    };\n\n    return useRealList(props, emitFunction);\n  },\n  render() {\n    const { props, resizeObserver } = this;\n\n    const {\n      itemKey,\n      headerClass,\n      headerStyle,\n      footerClass,\n      footerStyle,\n      stickyHeaderClass,\n      stickyHeaderStyle,\n      stickyFooterClass,\n      stickyFooterStyle,\n    } = props as RealListProps<any>;\n\n    const renderStickyHeaderSlot = (): VNode | null =>\n      getSlot(this, 'stickyHeader')\n        ? _h(\n            'div',\n            {\n              key: 'slot-sticky-header',\n              class: stickyHeaderClass,\n              style: `position: sticky; z-index: 10; 'top: 0; ${stickyHeaderStyle}`,\n              ref: 'stickyHeaderRefEl',\n              attrs: {\n                'data-id': 'stickyHeader',\n              },\n            },\n            [getSlot(this, 'stickyHeader')?.()],\n          )\n        : null;\n\n    const renderStickyFooterSlot = (): VNode | null =>\n      getSlot(this, 'stickyFooter')\n        ? _h(\n            'div',\n            {\n              key: 'slot-sticky-footer',\n              class: stickyFooterClass,\n              style: `position: sticky; z-index: 10; bottom: 0; ${stickyFooterStyle}`,\n              ref: 'stickyFooterRefEl',\n              attrs: {\n                'data-id': 'stickyFooter',\n              },\n            },\n            [getSlot(this, 'stickyFooter')?.()],\n          )\n        : null;\n\n    const renderHeaderSlot = (): VNode | null =>\n      getSlot(this, 'header')\n        ? _h(\n            'div',\n            {\n              key: 'slot-header',\n              class: headerClass,\n              style: headerStyle,\n              ref: 'headerRefEl',\n              attrs: {\n                'data-id': 'header',\n              },\n            },\n            [getSlot(this, 'header')?.()],\n          )\n        : null;\n\n    const renderFooterSlot = (): VNode | null =>\n      getSlot(this, 'footer')\n        ? _h(\n            'div',\n            {\n              key: 'slot-footer',\n              class: footerClass,\n              style: footerStyle,\n              ref: 'footerRefEl',\n              attrs: {\n                'data-id': 'footer',\n              },\n            },\n            [getSlot(this, 'footer')?.()],\n          )\n        : null;\n\n    const renderMainList = (): VNode | null => {\n      const mainList = [];\n      for (let i = 0; i < props.list.length; i++) {\n        const currentItem = props.list[i];\n        mainList.push(\n          _h(\n            ObserverItem,\n            {\n              key: currentItem[itemKey],\n              attrs: {\n                id: currentItem[itemKey],\n                resizeObserver: resizeObserver,\n              },\n            },\n            {\n              default: () =>\n                getSlot(\n                  this,\n                  'default',\n                )?.({\n                  itemData: currentItem,\n                }),\n            },\n          ),\n        );\n      }\n      return _h(\n        'div',\n        {\n          ref: 'listRefEl',\n        },\n        [mainList],\n      );\n    };\n\n    return _h(\n      'div',\n      {\n        ref: 'clientRefEl',\n        style: `width: 100%; height: 100%; overflow: overlay;`,\n        attrs: {\n          'data-id': 'client',\n        },\n      },\n      [\n        renderStickyHeaderSlot(),\n        renderHeaderSlot(),\n        renderMainList(),\n        renderFooterSlot(),\n        renderStickyFooterSlot(),\n      ],\n    );\n  },\n});\n\nexport { RealList };\n","import { defineComponent, shallowRef, watch, ref, type Ref } from 'vue-demi';\nimport { VirtList } from './VirtList';\nimport { _h, _h2Slot, getSlot } from './util';\n\nconst VirtGrid = defineComponent({\n  name: 'VirtGrid',\n  props: {\n    list: {\n      type: Array,\n      default: () => [],\n    },\n    gridItems: {\n      type: Number,\n      default: 2,\n    },\n    itemStyle: {\n      type: String,\n      default: '',\n    },\n  },\n  setup(props) {\n    const virtListRef = ref<typeof VirtList | null>(null);\n\n    const gridList: Ref<{ _id: number; children: any[] }[]> = shallowRef([]);\n\n    function updateList() {\n      // reset gridList\n      gridList.value = [];\n      for (let i = 0; i < props.list.length; i += props.gridItems) {\n        const children = [];\n        for (let j = 0; j < props.gridItems; j += 1) {\n          if (i + j >= props.list.length) break;\n          children.push(props.list[i + j]);\n        }\n        // id 是组件生成的\n        gridList.value.push({\n          _id: i,\n          children,\n        });\n      }\n      virtListRef?.value?.forceUpdate();\n    }\n\n    function scrollToIndex(index: number) {\n      const targetRowIndex = Math.floor(index / props.gridItems);\n      virtListRef?.value?.scrollToIndex(targetRowIndex);\n    }\n\n    function scrollIntoView(index: number) {\n      const targetRowIndex = Math.floor(index / props.gridItems);\n      virtListRef?.value?.scrollIntoView(targetRowIndex);\n    }\n\n    function scrollToTop() {\n      virtListRef?.value?.scrollToTop();\n    }\n\n    function scrollToBottom() {\n      virtListRef?.value?.scrollToBottom();\n    }\n\n    function scrollToOffset(offset: number) {\n      virtListRef?.value?.scrollToOffset(offset);\n    }\n\n    function forceUpdate() {\n      virtListRef?.value?.forceUpdate();\n    }\n\n    watch(\n      () => props.list.length,\n      () => {\n        updateList();\n      },\n      {\n        immediate: true,\n      },\n    );\n\n    watch(\n      () => props.gridItems,\n      () => {\n        if (props.gridItems <= 0) return;\n        gridList.value = [];\n        updateList();\n      },\n      {\n        immediate: true,\n      },\n    );\n\n    return {\n      virtListRef,\n      gridList,\n\n      // expose\n      updateList,\n      scrollToIndex,\n      scrollIntoView,\n      scrollToTop,\n      scrollToBottom,\n      scrollToOffset,\n      forceUpdate,\n    };\n  },\n  render() {\n    const rowRender = (rowData: { itemData: any; index: number }): any[] => {\n      const { itemData } = rowData;\n      const rows = [];\n      for (let i = 0; i < itemData.children.length; i += 1) {\n        rows.push(\n          getSlot(\n            this,\n            'default',\n          )?.({\n            itemData: itemData.children[i],\n            index: rowData.index,\n          }),\n        );\n      }\n      return rows;\n    };\n\n    return _h2Slot(\n      VirtList,\n      {\n        ref: 'virtListRef',\n        attrs: {\n          list: this.gridList,\n          itemKey: '_id',\n          itemStyle: `display: flex; min-width: min-content; ${this.itemStyle}`,\n          ...this.$attrs,\n        },\n      },\n      {\n        default: rowRender,\n        // transfer slots\n        stickyHeader: getSlot(this, 'stickyHeader'),\n        stickyFooter: getSlot(this, 'stickyFooter'),\n        header: getSlot(this, 'header'),\n        footer: getSlot(this, 'footer'),\n        empty: getSlot(this, 'empty'),\n      },\n    );\n  },\n});\n\nexport { VirtGrid };\n"],"names":["useObserverItem","props","itemRefEl","ref","onMounted","resizeObserver","value","observe","onBeforeUnmount","unobserve","ObserverItem","defineComponent","name","type","ResizeObserver","require","id","String","Number","setup","render","_h","attrs","getSlot","defaultProps","fixed","buffer","bufferTop","bufferBottom","scrollDistance","horizontal","fixSelection","start","offset","listStyle","listClass","itemStyle","itemClass","headerClass","headerStyle","footerClass","footerStyle","stickyHeaderClass","stickyHeaderStyle","stickyFooterClass","stickyFooterStyle","useVirtList","userProps","emitFunction","Proxy","get","target","key","Reflect","clientRefEl","listRefEl","headerRefEl","footerRefEl","stickyHeaderRefEl","stickyFooterRefEl","sizesMap","Map","renderKey","direction","fixOffset","forceFixOffset","abortFixOffset","fixTaskFn","slotSize","shallowReactive","clientSize","headerSize","footerSize","stickyHeaderSize","stickyFooterSize","reactiveData","views","listTotalSize","virtualSize","inViewBegin","inViewEnd","renderBegin","renderEnd","getOffset","directionKey","getSlotSize","getTotalSize","getItemSize","itemKey","minSize","setItemSize","size","set","deleteItemSize","delete","getItemPosByIndex","index","top","current","bottom","topReduce","i","currentSize","list","scrollToOffset","scrollToIndex","console","log","length","scrollToBottom","lastOffset","fixToIndex","scrollIntoView","targetMin","targetMax","offsetMin","offsetMax","scrollToTop","setTimeout","Math","abs","round","selection","window","getSelection","anchorNode","anchorOffset","focusNode","focusOffset","requestAnimationFrame","setBaseAndExtent","updateRange","isVue2","min","rangeUpdate","calcRange","offsetWithNoHeader","offsetReduce","getVirtualSize2beginInView","onScroll","evt","scroll","toTop","toBottom","calcViews","newViews","ceil","onClientResize","calcListTotalSize","re","reset","clear","forceUpdate","deletedList2Top","deletedList","deletedListSize","forEach","item","updateTotalVirtualSize","addedList2Top","addedList","addedListSize","undefined","entries","diff","entry","dataset","oldSize","newSize","borderBoxSize","contentBoxSize","Array","isArray","inlineSize","blockSize","contentRect","width","height","itemResize","currentFirst","onBeforeMount","addEventListener","removeEventListener","getRangeSize","range1","range2","end","max","renderList","shallowRef","manualRender","_newRenderBegin","_newRenderEnd","_oldRenderBegin","slice","watch","newVal","oldVal","_newInViewBegin","renderControl","begin","immediate","VirtList","default","required","Function","Boolean","context","emit","firstItem","lastItem","renderStickyHeaderSlot","class","style","renderStickyFooterSlot","renderHeaderSlot","renderFooterSlot","renderMainList","mainList","currentItem","push","itemData","dynamicListStyle","virtualStyle","miniSize","useRealList","offsetMap","isScrollTop","isScrollBottom","isUpdating","getScrollOffset","scrollTop","prevSize","updateOffset","scrollIntoPosition","currentScrollOffset","checkScrollStatus","getItemOffset","setItemOffset","debounce","func","wait","timeout","clearTimeout","currentKey","updateFirstKey","getCurrentFirstItem","updateCurrent","pageSize","currentStartOffset","scrollTargetToView","resolve","Promise","getOffsetByIndex","preDistance","distance","scrollToTargetOffset","targetOffset","bottomOffset","preScrollOffset","deep","onBeforeUpdate","onUpdated","RealList","ctx","VirtGrid","gridItems","virtListRef","gridList","updateList","children","j","_id","targetRowIndex","floor","rowRender","rowData","rows","_h2Slot","$attrs","stickyHeader","stickyFooter","header","footer","empty"],"mappings":"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"}